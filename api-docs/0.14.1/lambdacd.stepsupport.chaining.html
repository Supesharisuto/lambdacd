<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>lambdacd.stepsupport.chaining documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">LambdaCD</span> <span class="project-version">0.14.1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lambdacd</span></div></div></li><li class="depth-2 branch"><a href="lambdacd.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="lambdacd.event-bus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>event-bus</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>execution</span></div></div></li><li class="depth-3"><a href="lambdacd.execution.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>presentation</span></div></div></li><li class="depth-3 branch"><a href="lambdacd.presentation.pipeline-state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline-state</span></div></a></li><li class="depth-3 branch"><a href="lambdacd.presentation.pipeline-structure.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline-structure</span></div></a></li><li class="depth-3"><a href="lambdacd.presentation.unified.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>unified</span></div></a></li><li class="depth-2 branch"><a href="lambdacd.runners.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>runners</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></div></li><li class="depth-3 branch"><a href="lambdacd.state.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3"><a href="lambdacd.state.protocols.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocols</span></div></a></li><li class="depth-2 branch"><a href="lambdacd.step-id.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>step-id</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stepresults</span></div></div></li><li class="depth-3 branch"><a href="lambdacd.stepresults.flatten.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>flatten</span></div></a></li><li class="depth-3 branch"><a href="lambdacd.stepresults.merge.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>merge</span></div></a></li><li class="depth-3"><a href="lambdacd.stepresults.merge-resolvers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>merge-resolvers</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>steps</span></div></div></li><li class="depth-3 branch"><a href="lambdacd.steps.control-flow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control-flow</span></div></a></li><li class="depth-3 branch"><a href="lambdacd.steps.git.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>git</span></div></a></li><li class="depth-3 branch"><a href="lambdacd.steps.manualtrigger.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>manualtrigger</span></div></a></li><li class="depth-3"><a href="lambdacd.steps.shell.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shell</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>stepstatus</span></div></div></li><li class="depth-3 branch"><a href="lambdacd.stepstatus.predicates.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>predicates</span></div></a></li><li class="depth-3"><a href="lambdacd.stepstatus.unify.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>unify</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>stepsupport</span></div></div></li><li class="depth-3 branch current"><a href="lambdacd.stepsupport.chaining.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chaining</span></div></a></li><li class="depth-3 branch"><a href="lambdacd.stepsupport.killable.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>killable</span></div></a></li><li class="depth-3 branch"><a href="lambdacd.stepsupport.metadata.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>metadata</span></div></a></li><li class="depth-3"><a href="lambdacd.stepsupport.output.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>output</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>ui</span></div></div></li><li class="depth-3 branch"><a href="lambdacd.ui.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-3 branch"><a href="lambdacd.ui.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3"><a href="lambdacd.ui.ui-page.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ui-page</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="lambdacd.stepsupport.chaining.html#var-always-chain-steps"><div class="inner"><span>always-chain-steps</span></div></a></li><li class="depth-1"><a href="lambdacd.stepsupport.chaining.html#var-always-chaining"><div class="inner"><span>always-chaining</span></div></a></li><li class="depth-1"><a href="lambdacd.stepsupport.chaining.html#var-chain-steps"><div class="inner"><span>chain-steps</span></div></a></li><li class="depth-1"><a href="lambdacd.stepsupport.chaining.html#var-chaining"><div class="inner"><span>chaining</span></div></a></li><li class="depth-1"><a href="lambdacd.stepsupport.chaining.html#var-injected-args"><div class="inner"><span>injected-args</span></div></a></li><li class="depth-1"><a href="lambdacd.stepsupport.chaining.html#var-injected-ctx"><div class="inner"><span>injected-ctx</span></div></a></li><li class="depth-1"><a href="lambdacd.stepsupport.chaining.html#var-last-step-status-wins"><div class="inner"><span>last-step-status-wins</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">lambdacd.stepsupport.chaining</h1><div class="doc"><div class="markdown"><p>Functions that allow you to use LambdaCDs pipeline mechanisms inside a step, i.e. chain several steps together:</p>
<pre><code class="clojure">(defn some-step [args ctx]
  (chaining args ctx
            (shell/bash injected-ctx "/ " "echo hello ")
            (shell/bash injected-ctx "/ " "echo world ")))

(defn some-step-with-error-handling [args ctx]
  (always-chaining args ctx
                   (run-tests injected-args injected-ctx)
                   (if (= :failure (:status injected-args))
                     (publish-test-failures injected-args injected-ctx))))
</code></pre></div></div><div class="public anchor" id="var-always-chain-steps"><h3>always-chain-steps</h3><div class="usage"><code>(always-chain-steps args ctx &amp; steps)</code></div><div class="doc"><div class="markdown"><p>Like <code>chain-steps</code> but does not stop after failure.</p></div></div><div class="src-link"><a href="https://github.com/flosell/lambdacd/blob/master/src/clj/lambdacd/stepsupport/chaining.clj#L71">view source</a></div></div><div class="public anchor" id="var-always-chaining"><h3>always-chaining</h3><h4 class="type">macro</h4><div class="usage"><code>(always-chaining args ctx &amp; forms)</code></div><div class="doc"><div class="markdown"><p>Like <code>chaining</code> but does not stop on failures. Status of the chain will be failure if one of the steps in the chain failed. Use <code>last-step-status-wins</code> to make the chain succeed even though a step in the chain failed.</p></div></div><div class="src-link"><a href="https://github.com/flosell/lambdacd/blob/master/src/clj/lambdacd/stepsupport/chaining.clj#L120">view source</a></div></div><div class="public anchor" id="var-chain-steps"><h3>chain-steps</h3><div class="usage"><code>(chain-steps args ctx &amp; steps)</code></div><div class="doc"><div class="markdown"><p>Takes a number of steps executes them as if they were part of the pipeline, i.e. will execute them one after the other, stop on failures and call the next step with the the results of the previous step as <code>args</code>. Think of this as an opinionated take on <code>execute-steps</code> so for full flexibility, use <code>execute-steps</code> directly.</p>
<p>Look at the <code>chaining</code>-macro for a more flexible syntax.</p>
<p>Example:</p>
<pre><code class="clojure">(chain-steps (some-args) (some-ctx)
             some-step
             some-other-step)
</code></pre></div></div><div class="src-link"><a href="https://github.com/flosell/lambdacd/blob/master/src/clj/lambdacd/stepsupport/chaining.clj#L53">view source</a></div></div><div class="public anchor" id="var-chaining"><h3>chaining</h3><h4 class="type">macro</h4><div class="usage"><code>(chaining args ctx &amp; forms)</code></div><div class="doc"><div class="markdown"><p>Syntactic sugar for <code>chain-steps</code>. Can work with arbitrary code and can inject <code>args</code> and <code>ctx</code>.</p>
<p>Example:</p>
<pre><code class="clojure">(chaining (some-args) (some-ctx)
          (some-step injected-args injected-ctx)
          (some-other-step injected-args injected-ctx))
</code></pre></div></div><div class="src-link"><a href="https://github.com/flosell/lambdacd/blob/master/src/clj/lambdacd/stepsupport/chaining.clj#L108">view source</a></div></div><div class="public anchor" id="var-injected-args"><h3>injected-args</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Placeholder for <code>args</code> for use in <code>chaining</code> and <code>always-chaining</code></p></div></div><div class="src-link"><a href="https://github.com/flosell/lambdacd/blob/master/src/clj/lambdacd/stepsupport/chaining.clj#L79">view source</a></div></div><div class="public anchor" id="var-injected-ctx"><h3>injected-ctx</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Placeholder for <code>ctx</code> for use in <code>chaining</code> and <code>always-chaining</code></p></div></div><div class="src-link"><a href="https://github.com/flosell/lambdacd/blob/master/src/clj/lambdacd/stepsupport/chaining.clj#L80">view source</a></div></div><div class="public anchor" id="var-last-step-status-wins"><h3>last-step-status-wins</h3><div class="usage"><code>(last-step-status-wins step-result)</code></div><div class="doc"><div class="markdown"><p>Takes a step result from chaining or execute-steps and replaces its status with the status of the last child. Often used together with always-chaining to be able to control the chains end-result after an element of the chain failed (see <a href="https://github.com/flosell/lambdacd/issues/122">#122</a> for details).</p>
<p>Example:</p>
<pre><code class="clojure">(last-step-status-wins
  (always-chaining args ctx
                   (check-something injected-args injected-ctx)
                   (if (= :failure (:status injected-args))
                     (manualtrigger/wait-for-manual-trigger injected-args injected-ctx)
                     {:status :success})))
</code></pre></div></div><div class="src-link"><a href="https://github.com/flosell/lambdacd/blob/master/src/clj/lambdacd/stepsupport/chaining.clj#L125">view source</a></div></div></div></body></html>